# 專案憲法模板

**版本**: [CONSTITUTION_VERSION]
**批准日期**: [RATIFICATION_DATE]
**最後修訂日期**: [LAST_AMENDED_DATE]

---

### 強制要求規則(每次輸出時都需要逐一審視)

#### 規則1: 語言使用規範(Language Prototcol)
  - **要求**: 
    - 所有對話、回應、文件內容生成 `必須` 使用繁體中文。
    - 文件包含: spec.md、checklists/requirements.md 檔案都 `必須` 使用繁體中文。
    - 不可使用任何的表情符號，來輔助說明。

  - **例外情況**: 
    - 專有名詞 (如: Java、Python、Spring boot、FastAPI、PostgreSQL、Restful API)。
    - 技術縮寫 (Json、HTTP、CRUD)。
    - 程式碼區塊內的變數名、函數名。
    - 引用外部文件的檔案路徑或命名。

#### 規則2: 文件結構規範 (Documentation Structure Protocol)
  - **要求**:
    - 所有規格文件 **必須** 包含完整的 frontmatter (標題、版本、狀態、最後修訂日期)。
    - 使用者故事 **必須** 按優先級排序(P1, P2, P3)。
    - 每個需求 **必須** 有唯一的編號(FR-001, NFR-001)。
    - 所有驗收標準 **必須** 使用 `Given-When-Then` 格式。

#### 規則3: 外部資源參考
  - **要求**:
    - **可以** 參考來自 `./memory/references-docs/` 目錄下的架構設計文件、技術規範或其他參考文件。
    - 引用的外部資源 **必須** 使用 Markdown 或 Mermaid 格式呈現。
        - 引用時 **必須** 明確標註來源檔案路徑（例如：`參考: ./memory/references-docs/architecture.md`）。
        - 若外部資源與當前需求衝突，**必須** 優先遵循當前專案的規格文件(spec.md)。
    - **適用情境**:
        - 技術計劃（plan.md）中引用標準架構模式。
        - 資料模型設計參考既有的 schema 定義。
        - API 設計遵循既有的 API 規範文件。
        - 安全性實作參考標準安全指南。
    - **限制**:
        - 引用的外部資源 **不可** 違反本憲法的強制要求規則。

#### 規則4: 安全性規範 (Security Protocol)
  - 核心規則:
    - 不在程式碼中硬編碼敏感資訊（密碼、API 金鑰、token）。
    - 使用環境變數或密鑰管理服務。
    - 遵循最小權限原則。
  - 例外情況:
    - 若是程式作法來自 `./memory/references-docs/` 底下的檔案設計, 則不在此限。

---

### 設計原則

#### 原則1: 規格驅動開發 (Specification-Driven Development, SDD)

  - **定義**: 所有功能 **必須** 在實現前開始於書面規格。
  - **不可妥協的**: 
    - 每個功能需求 **必須** 在任何程式碼編寫前，以正式規格文件(`specs/[####-feature-name]/spec.md`) 形式紀錄。
    - 規格(spec) **必須** 包含用戶故事(User story)、優先級(Priority) 的驗收標準或獨立的測試情境。
    - 每個需求必須有唯一的編號(FR-001, NFR-001)。
    - 所有文件必須使用 Markdown 格式。

#### 原則2: 用戶故事獨立性 (User Story Independence)

  - **定義**: 功能內的每個優先級用戶故事 **必須** 可獨立實現、測試和交付。
  - **不可妥協的**:
    - 單一功能內的用戶故事(User story) **必須** 能夠在不依賴相同功能中其他故事的情況下實現和測試。
    - 每個故事 **必須** 獨立提供可衡量的價值; 故事 **不能** 被人為分割只為了達到數量。
    - 任務組織 **必須** 按用戶故事(US1、US2、US3 ...) 分組。
    - 只有當驗收集合中的所有用戶故事都能獨立驗證時，功能才可被視為完成。

#### 原則3: 測試驅動開發 (Test-Driven Developement, TDD)
  - **定義**: 所有程式碼 **必須** 先撰寫測試，再實作功能。遵循「紅-綠-重構」循環。
  - **不可妥協的**:
    - 在撰寫任何功能程式碼前，**必須** 先撰寫對應的測試案例。
    - 測試案例 **必須** 基於 spec.md 中定義的驗收標準和測試情境。
    - 每個功能需求（FR-###）**必須** 至少有一個對應的測試案例。
    - 測試 **必須** 涵蓋正常流程、邊界情況和錯誤處理。
    - 所有測試 **必須** 在功能標記為完成前通過。
    - 測試命名 **必須** 清楚描述測試目的（使用中文註解說明）。
    - 重構時 **不可** 改變現有測試的行為，除非需求變更。
  - **TDD 循環**:
    1. 紅燈(Red): 撰寫一個失敗的測試
    2. 綠燈(Green): 撰寫最少的程式碼使測試通過
    3. 重構(Refactor): 改善程式碼品質，確保測試仍然通過

#### 原則4: 關注點分離 (Separation of Concerns, SoC)
  - **定義**: 文件和程式碼 **必須** 明確區分不同層次的關注點，避免混淆業務需求與技術實作。
  - **不可妥協的**:
    - **規格文件（spec.md）** **必須** 只描述「做什麼」和「為什麼」，**不可** 包含技術實作細節（如框架、API、資料庫選擇）。
    - **技術計劃（plan.md）** **必須** 只描述「如何做」，包含架構設計、技術選型、資料模型等技術決策。
    - **任務清單（tasks.md）** **必須** 將實作分解為具體的、可執行的步驟，按用戶故事分組。
    - **程式碼實作** **必須** 遵循技術計劃的架構設計，實現任務清單中的具體任務。
    - 每個文件 **必須** 維持其專屬的職責範圍，**不可** 跨界描述其他層次的內容。
  - **流程說明**:
    - **文件層次關係**: `spec.md (業務層) → plan.md (技術層) → tasks.md (執行層) → 程式碼 (實作層)`
    - **驗證標準**:
      - 非技術人員應能理解 spec.md
      - 技術人員應能根據 plan.md 進行實作
      - 開發人員應能按 tasks.md 逐步完成工作

#### 原則5: 漸進式交付 (Incremental Delivery)
  - **定義**: 功能 **必須** 按優先級漸進式開發和交付，確保每個階段都能提供可用價值。
  - **不可妥協的**:
    - **必須** 按優先級順序實作(P1 → P2 → P3)。
    - 每個優先級的使用者故事完成後 **必須** 可獨立交付和驗證。
    - 高優先級功能 **不可** 依賴低優先級功能。
    - 每次交付 **必須** 包含對應的測試和文件更新。
    - 允許分階段發布，但每個階段都必須是完整可用的。

#### 原則6: 可維護性優先 (Maintainability First)
  - **定義**: 程式碼的可讀性和可維護性 **必須** 優先於簡潔性和效能優化，除非有明確的效能需求。
  - **不可妥協的**:
    - 程式碼 **必須** 遵循 `SOLID` 原則：
      - 單一職責 (Single Responsibility): 每個類別或函數只負責一件事。
      - 開放封閉 (Open/Closed): 對擴充開放，對修改封閉。
      - 里氏替換 (Liskov Substitution): 子類別可以替換父類別。
      - 介面隔離 (Interface Segregation): 不應強迫實作不需要的介面。
      - 依賴反轉 (Dependency Inversion): 依賴抽象而非具體實作。
    - 程式碼 **必須** 遵循 `KISS` 原則(Keep It Simple, Stupid):
      - 避免過度設計和不必要的複雜性。
      - 優先選擇簡單直觀的解決方案。
      - 只在真正需要時才引入抽象層。
    - 程式碼 **必須** 遵循 `DRY` 原則(Don't Repeat Yourself): 
      - 避免重複的程式碼邏輯。
      - 將共用邏輯提取為可重用的函數或模組。
      - 使用配置檔案而非硬編碼重複的值。
    - 函數和方法 **必須** 保持簡短。
    - 複雜的邏輯 **必須** 包含註解說明其目的和運作方式。
    - 變數和函數命名 **必須** 具有描述性，能清楚表達其用途。
    - 避免使用「魔法數字」，使用具名常數或列舉。
  - 程式碼品質標準:
    - 可讀性優於簡潔性
    - 明確性優於隱晦性
    - 實用性優於完美性
    - 簡單優於複雜

#### 原則7: 錯誤處理優先 (Error-First Design)
  - **定義**: 設計和實作時 **必須** 優先考慮錯誤情境和邊界條件。
  - **不可妥協的**:
    - 所有外部呼叫(API、資料庫、檔案系統) **必須** 包含錯誤處理。
    - 錯誤訊息 **必須** 使用繁體中文，清楚描述問題和可能的解決方案。
    - **必須** 記錄所有錯誤到日誌系統(含錯誤類型、發生時間、相關上下文)。
    - **必須** 在 spec.md 的「邊界情況」章節中定義錯誤處理策略。
    - 使用者輸入 **必須** 進行驗證和清理，防止注入攻擊。
    - 系統錯誤 **不可** 暴露敏感資訊(如: 堆疊追蹤、資料庫結構) 給終端使用者。


