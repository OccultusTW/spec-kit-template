````markdown
---
description: 從互動式或提供的原則輸入建立或更新專案章程，確保所有依賴模板保持同步。
handoffs: 
  - label: 建立規格
    agent: speckit.specify
    prompt: 根據更新的章程實作功能規格。我想建構...
---

## 使用者輸入

```text
$ARGUMENTS
```

在繼續之前，您**必須**考慮使用者輸入（如果不為空）。

## 大綱

您正在更新 `.specify/memory/constitution.md` 的專案章程。此檔案是一個模板，包含方括號中的佔位符令牌（例如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）。您的工作是 (a) 收集/派生具體值，(b) 精確填寫模板，以及 (c) 在依賴工件之間傳播任何修正。

遵循此執行流程：

1. 載入 `.specify/memory/constitution.md` 的現有章程模板。
   - 識別 `[ALL_CAPS_IDENTIFIER]` 形式的每個佔位符令牌。
   **重要**：使用者可能需要比模板中使用的更少或更多的原則。如果指定了數字，請尊重它 - 遵循一般模板。您將相應地更新文件。

2. 收集/派生佔位符的值：
   - 如果使用者輸入（對話）提供值，請使用它。
   - 否則從現有儲存庫背景推斷（README、文件、先前的章程版本（如果嵌入））。
   - 對於治理日期：`RATIFICATION_DATE` 是原始採用日期（如果未知則詢問或標記 TODO），`LAST_AMENDED_DATE` 是今天（如果進行更改），否則保留先前的。
   - `CONSTITUTION_VERSION` 必須根據語意版本控制規則遞增：
     - MAJOR：向後不相容的治理/原則刪除或重新定義。
     - MINOR：添加或實質擴展新原則/部分。
     - PATCH：釐清、措辭、拼寫錯誤修正、非語意改進。
   - 如果版本提升類型模糊，在最終確定之前提出推理。

3. 起草更新的章程內容：
   - 用具體文字替換每個佔位符（除了專案選擇不定義的故意保留的模板槽外，沒有括號令牌 - 明確證明任何剩餘的）。
   - 保留標題層次結構，一旦替換，可以刪除註釋，除非它們仍然添加釐清指導。
   - 確保每個原則部分：簡潔的名稱行、段落（或項目符號清單）捕獲不可協商的規則、如果不明顯則明確的理由。
   - 確保治理部分列出修正程序、版本控制政策和合規性審查期望。

4. 一致性傳播檢查清單（將先前的檢查清單轉換為主動驗證）：
   - 讀取 `.specify/templates/plan-template.md` 並確保任何「章程檢查」或規則與更新的原則一致。
   - 讀取 `.specify/templates/spec-template.md` 以進行範圍/需求對齊 - 如果章程添加/刪除必填部分或限制，則更新。
   - 讀取 `.specify/templates/tasks-template.md` 並確保任務分類反映新的或刪除的原則驅動的任務類型（例如可觀察性、版本控制、測試紀律）。
   - 讀取 `.specify/templates/commands/*.md` 中的每個命令檔案（包括這個），以驗證在需要通用指導時沒有過時的參考（僅代理特定的名稱，如 CLAUDE）。
   - 讀取任何執行時指導文件（例如 `README.md`、`docs/quickstart.md` 或代理特定的指導檔案（如果存在））。更新對更改的原則的參考。

5. 產生同步影響報告（在更新後作為 HTML 註釋添加到章程檔案的頂部）：
   - 版本更改：舊 → 新
   - 修改的原則清單（如果重新命名，舊標題 → 新標題）
   - 添加的部分
   - 刪除的部分
   - 需要更新的模板（✅ 已更新 / ⚠ 待處理），帶有檔案路徑
   - 如果有任何佔位符故意延遲，則後續 TODO。

6. 最終輸出前的驗證：
   - 沒有剩餘的未解釋的括號令牌。
   - 版本行與報告符合。
   - 日期 ISO 格式 YYYY-MM-DD。
   - 原則是聲明性的、可測試的，並且沒有模糊的語言（「應該」→ 在適當的地方用必須/應該理由替換）。

7. 將完成的章程寫回 `.specify/memory/constitution.md`（覆蓋）。

8. 向使用者輸出最終摘要：
   - 新版本和提升理由。
   - 標記為手動後續的任何檔案。
   - 建議的提交訊息（例如 `docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

格式與樣式需求：

- 完全按照模板中的 Markdown 標題使用（不要降級/提升級別）。
- 換行長理由行以保持可讀性（理想情況下 <100 字元），但不要用尷尬的中斷強制執行。
- 部分之間保持單個空行。
- 避免尾隨空格。

如果使用者提供部分更新（例如僅一個原則修訂），仍然執行驗證和版本決策步驟。

如果缺少關鍵資訊（例如批准日期確實未知），插入 `TODO(<FIELD_NAME>): explanation` 並包含在延遲項目下的同步影響報告中。

不要建立新模板；始終對現有的 `.specify/memory/constitution.md` 檔案進行操作。

````