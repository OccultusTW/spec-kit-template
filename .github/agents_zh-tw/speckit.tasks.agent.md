````markdown
---
description: 根據可用的設計工件為功能生成可操作的、依賴關係排序的 tasks.md。
handoffs: 
  - label: 分析一致性
    agent: speckit.analyze
    prompt: 執行專案分析以檢查一致性
    send: true
  - label: 實作專案
    agent: speckit.implement
    prompt: 分階段開始實作
    send: true
---

## 使用者輸入

```text
$ARGUMENTS
```

在繼續之前，您**必須**考慮使用者輸入（如果不為空）。

## 大綱

1. **設定**：從儲存庫根目錄執行 `.specify/scripts/bash/check-prerequisites.sh --json` 並解析 FEATURE_DIR 和 AVAILABLE_DOCS 列表。所有路徑必須是絕對路徑。對於參數中的單引號（如 "I'm Groot"），使用轉義語法：例如 'I'\''m Groot'（或盡可能使用雙引號："I'm Groot"）。

2. **載入設計文件**：從 FEATURE_DIR 讀取：
   - **必需**：plan.md（技術堆疊、程式庫、結構）、spec.md（具有優先級的使用者故事）
   - **可選**：data-model.md（實體）、contracts/（API 端點）、research.md（決策）、quickstart.md（測試情境）
   - 注意：並非所有專案都有所有文件。根據可用內容生成任務。

3. **執行任務生成工作流程**：
   - 載入 plan.md 並提取技術堆疊、程式庫、專案結構
   - 載入 spec.md 並提取具有優先級（P1、P2、P3 等）的使用者故事
   - 如果 data-model.md 存在：提取實體並映射到使用者故事
   - 如果 contracts/ 存在：將端點映射到使用者故事
   - 如果 research.md 存在：提取設定任務的決策
   - 生成按使用者故事組織的任務（請參閱下面的任務生成規則）
   - 生成顯示使用者故事完成順序的依賴關係圖
   - 為每個使用者故事建立並行執行範例
   - 驗證任務完整性（每個使用者故事都有所有需要的任務，可獨立測試）

4. **生成 tasks.md**：使用 `.specify.specify/templates/tasks-template.md` 作為結構，填入：
   - 來自 plan.md 的正確功能名稱
   - 階段 1：設定任務（專案初始化）
   - 階段 2：基礎任務（所有使用者故事的阻塞性先決條件）
   - 階段 3+：每個使用者故事一個階段（按 spec.md 的優先順序）
   - 每個階段包括：故事目標、獨立測試標準、測試（如要求）、實作任務
   - 最終階段：打磨與跨領域關注點
   - 所有任務必須遵循嚴格的檢查清單格式（請參閱下面的任務生成規則）
   - 每個任務的清晰檔案路徑
   - 顯示故事完成順序的依賴關係部分
   - 每個故事的並行執行範例
   - 實作策略部分（MVP 優先、增量交付）

5. **報告**：輸出生成的 tasks.md 路徑和摘要：
   - 總任務計數
   - 每個使用者故事的任務計數
   - 識別的並行機會
   - 每個故事的獨立測試標準
   - 建議的 MVP 範圍（通常僅使用者故事 1）
   - 格式驗證：確認所有任務都遵循檢查清單格式（複選框、ID、標籤、檔案路徑）

任務生成的背景：$ARGUMENTS

tasks.md 應該可立即執行 - 每個任務必須足夠具體，以便 LLM 可以在沒有額外背景的情況下完成它。

## 任務生成規則

**關鍵**：任務必須按使用者故事組織，以實現獨立的實作和測試。

**測試是可選的**：僅在功能規格中明確要求或使用者要求 TDD 方法時生成測試任務。

### 檢查清單格式（必需）

每個任務必須嚴格遵循此格式：

```text
- [ ] [TaskID] [P?] [Story?] 描述與檔案路徑
```

**格式元件**：

1. **複選框**：始終以 `- [ ]`（markdown 複選框）開始
2. **任務 ID**：按執行順序的序號（T001、T002、T003...）
3. **[P] 標記**：僅當任務可並行化時包含（不同檔案，對未完成任務無依賴關係）
4. **[Story] 標籤**：僅對使用者故事階段任務為必需
   - 格式：[US1]、[US2]、[US3] 等（映射到 spec.md 的使用者故事）
   - 設定階段：無故事標籤
   - 基礎階段：無故事標籤
   - 使用者故事階段：必須有故事標籤
   - 打磨階段：無故事標籤
5. **描述**：清晰的動作與確切的檔案路徑

**範例**：

- ✅ 正確：`- [ ] T001 根據實作計劃建立專案結構`
- ✅ 正確：`- [ ] T005 [P] 在 src/middleware/auth.py 中實作認證中介軟體`
- ✅ 正確：`- [ ] T012 [P] [US1] 在 src/models/user.py 中建立 User 模型`
- ✅ 正確：`- [ ] T014 [US1] 在 src/services/user_service.py 中實作 UserService`
- ❌ 錯誤：`- [ ] 建立 User 模型`（缺少 ID 和故事標籤）
- ❌ 錯誤：`T001 [US1] 建立模型`（缺少複選框）
- ❌ 錯誤：`- [ ] [US1] 建立 User 模型`（缺少任務 ID）
- ❌ 錯誤：`- [ ] T001 [US1] 建立模型`（缺少檔案路徑）

### 任務組織

1. **從使用者故事（spec.md）** - 主要組織：
   - 每個使用者故事（P1、P2、P3...）都有自己的階段
   - 將所有相關元件映射到它們的故事：
     - 該故事所需的模型
     - 該故事所需的服務
     - 該故事所需的端點/UI
     - 如果要求測試：該故事特定的測試
   - 標記故事依賴關係（大多數故事應該是獨立的）

2. **從合約**：
   - 將每個合約/端點 → 映射到它服務的使用者故事
   - 如果要求測試：每個合約 → 在該故事階段的實作之前進行合約測試任務 [P]

3. **從資料模型**：
   - 將每個實體映射到需要它的使用者故事
   - 如果實體服務多個故事：放在最早的故事或設定階段
   - 關係 → 適當故事階段的服務層任務

4. **從設定/基礎設施**：
   - 共享基礎設施 → 設定階段（階段 1）
   - 基礎/阻塞任務 → 基礎階段（階段 2）
   - 故事特定的設定 → 在該故事的階段內

### 階段結構

- **階段 1**：設定（專案初始化）
- **階段 2**：基礎（阻塞性先決條件 - 在使用者故事之前必須完成）
- **階段 3+**：按優先順序排列的使用者故事（P1、P2、P3...）
  - 在每個故事內：測試（如要求）→ 模型 → 服務 → 端點 → 整合
  - 每個階段應該是一個完整的、可獨立測試的增量
- **最終階段**：打磨與跨領域關注點

````